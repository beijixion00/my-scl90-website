# SCL-90 数据迁移完整指南

## 数据安全性保证

✅ **是的，客户的数据在后期迁移时完全不会丢失！**

只要使用云数据库（MongoDB Atlas），无论您如何更换服务器或域名，所有用户数据都会完整保留。

## 当前版本对比

| 版本 | 数据存储 | 数据持久性 | 迁移后数据 |
|------|----------|------------|------------|
| server.js | 内存存储 | ❌ 服务器重启后丢失 | 无法迁移 |
| server-cloud.js | MongoDB云数据库 | ✅ 永久保存 | ✅ 完全保留 |

## 立即实施方案

### 步骤1：设置MongoDB Atlas（免费）

1. **注册账号**
   - 访问：https://www.mongodb.com/atlas
   - 选择免费套餐（512MB存储）

2. **创建集群**
   - 选择云服务商：AWS
   - 选择区域：推荐选择亚洲区域
   - 集群层级：M0 Sandbox（免费）

3. **创建数据库用户**
   - 用户名：scl90admin
   - 密码：生成强密码

4. **获取连接字符串**
   ```
   mongodb+srv://scl90admin:YOUR_PASSWORD@cluster.mongodb.net/scl90
   ```

### 步骤2：配置环境变量

1. 编辑 `.env` 文件：
   ```env
   MONGODB_URI=mongodb+srv://scl90admin:YOUR_PASSWORD@cluster.mongodb.net/scl90
   ```

2. 在Vercel中设置环境变量：
   - 进入Vercel项目设置
   - 添加环境变量：`MONGODB_URI`
   - 值：您的MongoDB连接字符串

### 步骤3：部署云数据库版本

1. **本地测试**
   ```bash
   npm run cloud
   ```

2. **上传到GitHub**
   ```bash
   git add .
   git commit -m "升级到云数据库版本"
   git push origin main
   ```

3. **Vercel自动部署**
   - Vercel会自动检测到更新
   - 使用新的云数据库版本

## 迁移时的数据保障

### 场景1：Vercel → 阿里云ECS
```
✅ 数据完全保留
- 云数据库数据不变
- 只需更换服务器
- 用户无感知
```

**迁移步骤：**
1. 在阿里云ECS部署相同代码
2. 使用相同的MongoDB连接字符串
3. 修改DNS指向新服务器
4. 数据完全保留

### 场景2：免费MongoDB → 付费MongoDB
```
✅ 数据完全保留
- 使用MongoDB Atlas的数据导出/导入功能
- 几秒钟完成迁移
- 零停机时间
```

### 场景3：MongoDB → 其他数据库
```
✅ 数据完全保留
- 导出数据为JSON格式
- 转换并导入新数据库
- 保持数据完整性
```

## 数据备份策略

### 自动备份（推荐）
- MongoDB Atlas自动备份
- 每日增量备份
- 保留30天历史
- 一键恢复功能

### 手动备份
```bash
# 导出数据
mongodump --uri="mongodb+srv://..." --out=./backup

# 恢复数据
mongorestore --uri="mongodb+srv://..." ./backup
```

## 迁移测试流程

1. **测试环境验证**
   - 复制生产数据到测试库
   - 在测试环境验证迁移流程
   - 确认数据完整性

2. **生产环境迁移**
   - 选择低峰时段
   - 备份当前数据
   - 执行迁移操作
   - 验证服务正常

## 常见问题解答

**Q: 迁移过程中用户能正常使用吗？**
A: 可以。云数据库迁移零停机，用户完全无感知。

**Q: 数据迁移需要多长时间？**
A: MongoDB Atlas之间迁移通常几分钟内完成。

**Q: 如果迁移失败了怎么办？**
A: MongoDB Atlas有自动回滚机制，数据不会丢失。

**Q: 5个测评网站的数据如何管理？**
A: 可以使用同一个数据库，添加`site_type`字段区分不同网站。

## 总结

**✅ 数据100%安全保证：**
- 云数据库永久存储
- 迁移过程零数据丢失
- 自动备份和恢复
- 支持无限次迁移

**现在就行动：**
1. 设置MongoDB Atlas
2. 部署cloud版本
3. 享受数据永久存储

无论未来如何更换服务器或域名，所有用户测评数据都会完整保留！